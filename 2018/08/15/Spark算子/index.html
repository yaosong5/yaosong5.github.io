<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta name="baidu-site-verification" content="WHXmBFaAkY">
    <meta name="google-site-verification" content="vDyi3jVPymP4jOpfzY4F1zG4-FXD1T-A5unnDJuNxhs">
    <meta charset="utf-8">
    

    <title>Sparkç®—å­æ¡ˆä¾‹ | é’¢é“é”…</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="[TOC] HelloWordï¼ŸWorldCount1sc.textfile(&quot;hdfs://master:9000/wc&quot;).flatMap(_.split(&quot;åˆ†éš”ç¬¦&quot;)).map((_,1)).reduceByKey(_+_).saveAsTextFile(&quot;hdfs://master:9000/wcResult&quot;) æ•°æ®æœ€å¼€å§‹åœ¨Driverï¼Œè®¡ç®—çš„æ—¶å€™æ•°æ®ä¼šæµå…¥workerå½“rddå½¢æˆè¿‡ç¨‹ä¸­">
<meta name="keywords" content="Spark">
<meta property="og:type" content="article">
<meta property="og:title" content="Sparkç®—å­æ¡ˆä¾‹">
<meta property="og:url" content="http://gangtieguo.cn/2018/08/15/Sparkç®—å­/index.html">
<meta property="og:site_name" content="é’¢é“é”…">
<meta property="og:description" content="[TOC] HelloWordï¼ŸWorldCount1sc.textfile(&quot;hdfs://master:9000/wc&quot;).flatMap(_.split(&quot;åˆ†éš”ç¬¦&quot;)).map((_,1)).reduceByKey(_+_).saveAsTextFile(&quot;hdfs://master:9000/wcResult&quot;) æ•°æ®æœ€å¼€å§‹åœ¨Driverï¼Œè®¡ç®—çš„æ—¶å€™æ•°æ®ä¼šæµå…¥workerå½“rddå½¢æˆè¿‡ç¨‹ä¸­">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://img.gangtieguo.cn/006tNbRwgy1fucjpo4afaj31ik056whp.jpg">
<meta property="og:image" content="http://img.gangtieguo.cn/006tNbRwgy1fuck6fl2chj30kg02ut96.jpg">
<meta property="og:image" content="http://img.gangtieguo.cn/006tNbRwgy1fuck87fxhij30ju02gt92.jpg">
<meta property="og:image" content="http://img.gangtieguo.cn/006tNbRwgy1fuck95wu88j30qo02o74x.jpg">
<meta property="og:image" content="http://img.gangtieguo.cn/006tNbRwgy1fucouprhcjj30s402yjs5.jpg">
<meta property="og:image" content="http://img.gangtieguo.cn/006tNbRwgy1fucpd6axxej30os034wf7.jpg">
<meta property="og:image" content="http://img.gangtieguo.cn/006tNbRwgy1fucpvxoentj31gw03276d.jpg">
<meta property="og:image" content="http://img.gangtieguo.cn/006tNbRwgy1fucpwdi27nj31g8032abq.jpg">
<meta property="og:updated_time" content="2019-06-17T04:40:09.401Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sparkç®—å­æ¡ˆä¾‹">
<meta name="twitter:description" content="[TOC] HelloWordï¼ŸWorldCount1sc.textfile(&quot;hdfs://master:9000/wc&quot;).flatMap(_.split(&quot;åˆ†éš”ç¬¦&quot;)).map((_,1)).reduceByKey(_+_).saveAsTextFile(&quot;hdfs://master:9000/wcResult&quot;) æ•°æ®æœ€å¼€å§‹åœ¨Driverï¼Œè®¡ç®—çš„æ—¶å€™æ•°æ®ä¼šæµå…¥workerå½“rddå½¢æˆè¿‡ç¨‹ä¸­">
<meta name="twitter:image" content="http://img.gangtieguo.cn/006tNbRwgy1fucjpo4afaj31ik056whp.jpg">
    

    

    
        <link rel="icon" href="/css/images/Basketball-icon.png">
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    
        <script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?e304a23572827f3ea779e13779ddb9b6";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    


     <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e304a23572827f3ea779e13779ddb9b6";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>
</html>
<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">é’¢é“é”…</span>
            </a>
            <nav id="main-nav">
            <a class="main-nav-link" href="/."><i class="fa fa-home"></i>ä¸»é¡µ</a>
            <a class="main-nav-link" href="/archives"><i class="fa fa-archive"></i>å½’æ¡£</a>
            <a class="main-nav-link" href="/categories"><i class="fa fa-folder"></i>åˆ†ç±»</a>
            <a class="main-nav-link" href="/tags"><i class="fa fa-tags"></i>æ ‡ç­¾</a>
            <a class="main-nav-link" href="/about"><i class="fa fa-user"></i>å…³äº</a>

               <!--   -->
               <!--     <a class="main-nav-link" href="/.">  -->
               <!--     <i class="fa fa-home"></i>  -->
               <!--     ä¸»é¡µ  -->
               <!--     </a>  -->
               <!--   -->
               <!--     <a class="main-nav-link" href="/archives">  -->
               <!--     <i class="fa fa-home"></i>  -->
               <!--     å½’æ¡£  -->
               <!--     </a>  -->
               <!--   -->
               <!--     <a class="main-nav-link" href="/categories">  -->
               <!--     <i class="fa fa-home"></i>  -->
               <!--     åˆ†ç±»  -->
               <!--     </a>  -->
               <!--   -->
               <!--     <a class="main-nav-link" href="/tags">  -->
               <!--     <i class="fa fa-home"></i>  -->
               <!--     æ ‡ç­¾  -->
               <!--     </a>  -->
               <!--   -->
               <!--     <a class="main-nav-link" href="/about">  -->
               <!--     <i class="fa fa-home"></i>  -->
               <!--     å…³äº  -->
               <!--     </a>  -->
               <!--   -->

            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/venum.gif">
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="æœç´¢">
         <!-- <button type="submit" class="search-form-submit"></button> -->
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            PAGES: 'é¡µé¢',
            CATEGORIES: 'åˆ†ç±»',
            TAGS: 'æ ‡ç­¾',
            UNTITLED: '(æœªå‘½å)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">ä¸»é¡µ</a></td>
                
                    <td><a class="main-nav-link" href="/archives">å½’æ¡£</a></td>
                
                    <td><a class="main-nav-link" href="/categories">åˆ†ç±»</a></td>
                
                    <td><a class="main-nav-link" href="/tags">æ ‡ç­¾</a></td>
                
                    <td><a class="main-nav-link" href="/about">å…³äº</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="æœç´¢">
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
             

                

<aside id="profile" class="profile-fixed">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/venum.gif">
            <h2 id="name">GTG</h2>
            <h3 id="title">Nothing</h3>
            <span id="location"><i class="fa fa-map-marker"></i>å››æµ·ä¸ºå®¶</span>
           
        </div>
      <div class="article-info profile-block">
            <div class="article-info-block">
                65
                <span>æ–‡ç« </span>
            </div>
            <div class="article-info-block">
                44
                <span>æ ‡ç­¾</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/yaosong5" target="_blank" title="github" class="tooltip">
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://weibo.com/gangtieguo/" target="_blank" title="weibo" class="tooltip">
                            <i class="fa fa-weibo"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>

        
        
    </div>


</aside>


            

            <section id="main"><article id="post-Sparkç®—å­" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            Sparkç®—å­æ¡ˆä¾‹
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/08/15/Sparkç®—å­/">
            <time datetime="2018-08-15T15:52:40.133Z" itemprop="datePublished">2018-08-15</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Spark/">Spark</a>
    </div>

                    </div>
                
            </header>
        
       
        
        <div class="article-entry" itemprop="articleBody">
        
            




            <p class="show-toc-btn hidden" id="show-toc-btn" onclick="showToc();">
                    <i class="fa fa-align-justify" aria-hidden="true"></i>
                    <span class="btn-text"> æ–‡ç« ç›®å½•</span>
            </p>


            <div id="toc toc-article " class="toc-article">
                <span id="toc-close" class="toc-close" title="éšè—ç›®å½•" onclick="showBtn();"><i class="fa fa-times" aria-hidden="true"></i></span>
                <strong class="toc-title">ç›®å½•</strong>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HelloWordï¼ŸWorldCount"><span class="toc-number">1.</span> <span class="toc-text">HelloWordï¼ŸWorldCount</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mapPartitions"><span class="toc-number">1.1.</span> <span class="toc-text">mapPartitions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mapPartitionsWithIndex"><span class="toc-number">1.2.</span> <span class="toc-text">mapPartitionsWithIndex</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aggregate-action"><span class="toc-number">1.3.</span> <span class="toc-text">aggregate (action)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aggregateByKey"><span class="toc-number">1.4.</span> <span class="toc-text">aggregateByKey</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#combineByKey"><span class="toc-number">1.5.</span> <span class="toc-text">combineByKey</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reduceByKey"><span class="toc-number">1.6.</span> <span class="toc-text">reduceByKey</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#groupByKey"><span class="toc-number">1.7.</span> <span class="toc-text">groupByKey</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#checkpoint"><span class="toc-number">1.8.</span> <span class="toc-text">checkpoint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#coalesce-repartition"><span class="toc-number">1.9.</span> <span class="toc-text">coalesce, repartition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#collectAsMap"><span class="toc-number">1.10.</span> <span class="toc-text">collectAsMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#countByKey"><span class="toc-number">1.11.</span> <span class="toc-text">countByKey</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#countByValue"><span class="toc-number">1.12.</span> <span class="toc-text">countByValue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#filterByRange"><span class="toc-number">1.13.</span> <span class="toc-text">filterByRange</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flatMapValues"><span class="toc-number">1.14.</span> <span class="toc-text">flatMapValues</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#foldByKey"><span class="toc-number">1.15.</span> <span class="toc-text">foldByKey</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#foreach"><span class="toc-number">1.16.</span> <span class="toc-text">foreach</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#foreachPartition"><span class="toc-number">1.17.</span> <span class="toc-text">foreachPartition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#keyBy"><span class="toc-number">1.18.</span> <span class="toc-text">keyBy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#keys-values"><span class="toc-number">1.19.</span> <span class="toc-text">keys values</span></a></li></ol></li></ol>
            </div>


            
            <script type="text/javascript">
                            function showBtn(){
                             if($('.toc-article').hasClass('hidden')){
                                    $('.toc-article').removeClass('hidden');
                                }else{
                                    $('.toc-article').addClass('hidden');
                                }
                                 $('.show-toc-btn').removeClass('hidden');  
                            };
                            function showToc(){
                              if($('.show-toc-btn').hasClass('hidden')){
                                      $('.show-toc-btn').removeClass('hidden');


                                  }else{
                                      $('.show-toc-btn').addClass('hidden');

                                  }
                                   $('.toc-article').removeClass('hidden');
                            };
             </script>

                <p>[TOC]</p>
<h1 id="HelloWordï¼ŸWorldCount"><a href="#HelloWordï¼ŸWorldCount" class="headerlink" title="HelloWordï¼ŸWorldCount"></a>HelloWordï¼ŸWorldCount</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.textfile(<span class="string">"hdfs://master:9000/wc"</span>).flatMap(_.split(<span class="string">"åˆ†éš”ç¬¦"</span>)).map((_,<span class="number">1</span>)).reduceByKey(_+_).saveAsTextFile(<span class="string">"hdfs://master:9000/wcResult"</span>)</span><br></pre></td></tr></table></figure>
<p>æ•°æ®æœ€å¼€å§‹åœ¨Driverï¼Œè®¡ç®—çš„æ—¶å€™æ•°æ®ä¼šæµå…¥worker<br>å½“rddå½¢æˆè¿‡ç¨‹ä¸­ï¼Œworkerçš„åˆ†åŒºä¸­åªæ˜¯é¢„ç•™äº†å­˜æ”¾æ•°æ®çš„ä½ç½®ï¼Œåªæœ‰å½“actionè§¦å‘çš„æ—¶å€™ï¼Œworkerçš„åˆ†åŒºä¸­æ‰ä¼šå­˜åœ¨æ•°æ®</p>
<p>Sparkçš„è¿ç®—éƒ½æ˜¯é€šè¿‡ç®—å­è¿›è¡ŒRDDçš„è½¬æ¢åŠè¿ç®—ï¼Œé‚£æˆ‘ä»¬å¯¹ç®—å­è¿›è¡Œç®€å•ç†Ÿæ‚‰<a href="http://homepage.cs.latrobe.edu.au/zhe/ZhenHeSparkRDDAPIExamples.html" target="_blank" rel="noopener">å‚è€ƒRDDç®—å­å®ä¾‹</a></p>
<a id="more"></a>
<p>reduceByKeyå…ˆè¿›è¡Œä¸€ä¸‹combineer ç§»åŠ¨è®¡ç®—</p>
<p>groupByKeyä¸å¥½</p>
<p>reduceByKeyä¼šåœ¨å±€éƒ¨å…ˆè¿›è¡Œä¸€ä¸‹æ±‚å’Œ</p>
<p>groupByKeyæ˜¯ä¼šå°†æ‰€æœ‰çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªå¤§é›†åˆé‡Œé¢ï¼Œç„¶åå†æ±‚å’Œ ï¼Œä¼šæ¶ˆè€—æ›´å¤šçš„ç½‘ç»œå¸¦å®½ï¼Œä¸ç¬¦åˆè®¡ç®—æœ¬åœ°åŒ–</p>
<p>ä¸€ä¸‹ä¸€äº›RDDæ˜¯ç»™äºˆrdd1æ¥æ“ä½œçš„</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>), <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h2 id="mapPartitions"><a href="#mapPartitions" class="headerlink" title="mapPartitions"></a>mapPartitions</h2><p>map æ˜¯å¯¹ rdd ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œï¼Œè€Œ mapPartitions(foreachPartition) åˆ™æ˜¯å¯¹ rdd ä¸­çš„æ¯ä¸ªåˆ†åŒºçš„è¿­ä»£å™¨è¿›è¡Œæ“ä½œã€‚å¦‚æœåœ¨ map è¿‡ç¨‹ä¸­éœ€è¦é¢‘ç¹åˆ›å»ºé¢å¤–çš„å¯¹è±¡ (ä¾‹å¦‚å°† rdd ä¸­çš„æ•°æ®é€šè¿‡ jdbc å†™å…¥æ•°æ®åº“, map éœ€è¦ä¸ºæ¯ä¸ªå…ƒç´ åˆ›å»ºä¸€ä¸ªé“¾æ¥è€Œ mapPartition ä¸ºæ¯ä¸ª partition åˆ›å»ºä¸€ä¸ªé“¾æ¥), åˆ™ mapPartitions æ•ˆç‡æ¯” map é«˜çš„å¤šã€‚</p>
<p>SparkSql æˆ– DataFrame é»˜è®¤ä¼šå¯¹ç¨‹åºè¿›è¡Œ mapPartition çš„ä¼˜åŒ–ã€‚</p>
<h2 id="mapPartitionsWithIndex"><a href="#mapPartitionsWithIndex" class="headerlink" title="mapPartitionsWithIndex"></a>mapPartitionsWithIndex</h2><p>mapPartitionWithIndexä¸mapPartitionç±»ä¼¼ï¼Œåªæ˜¯ä¼šå¸¦ä¸Šåˆ†åŒºçš„åºå·</p>
<p>æŠŠæ¯ä¸ªpartitionä¸­çš„<strong>åˆ†åŒºå·å’Œå¯¹åº”çš„å€¼</strong>æ‹¿å‡ºæ¥, æºç ä¸­æ–¹æ³•çš„å½¢å¼ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> func(index,<span class="type">Int</span>,iter:<span class="type">Interator</span>[(<span class="type">Int</span>)]):<span class="type">Interator</span>[<span class="type">String</span>] = &#123;</span><br><span class="line">iter.toList.map(x =&gt; <span class="string">"[partID:"</span> +  index + <span class="string">", val: "</span> + x + <span class="string">"]"</span>).iterator</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¼šè½¬æ¢æˆå‡½æ•°<br>å‡½æ•°çš„å½¢å¼</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> func = (index: <span class="type">Int</span>, iter: <span class="type">Iterator</span>[(<span class="type">Int</span>)]) =&gt; &#123;</span><br><span class="line">  iter.toList.map(x =&gt; <span class="string">"[partID:"</span> +  index + <span class="string">", val: "</span> + x + <span class="string">"]"</span>).iterator</span><br><span class="line">&#125;</span><br><span class="line">rdd1.mapPartitionsWithIndex(func).collect</span><br></pre></td></tr></table></figure>
<p><img src="http://img.gangtieguo.cn/006tNbRwgy1fucjpo4afaj31ik056whp.jpg" alt></p>
<h2 id="aggregate-action"><a href="#aggregate-action" class="headerlink" title="aggregate (action)"></a>aggregate (action)</h2><p>aggregateæ˜¯ä¸€ä¸ªactionæ“ä½œ</p>
<p>æºç å®šä¹‰</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aggregate</span></span>[<span class="type">U</span>](zeroValue: <span class="type">U</span>)(seqOp: (<span class="type">U</span>, <span class="type">T</span>) â‡’ <span class="type">U</span>, combOp: (<span class="type">U</span>, <span class="type">U</span>) â‡’ <span class="type">U</span>)(<span class="keyword">implicit</span> arg0: <span class="type">ClassTag</span>[<span class="type">U</span>]): <span class="type">U</span></span><br></pre></td></tr></table></figure>
<p>eqOp æ“ä½œä¼šèšåˆå„åˆ†åŒºä¸­çš„å…ƒç´ ï¼Œç„¶å combOp æ“ä½œæŠŠæ‰€æœ‰åˆ†åŒºçš„èšåˆç»“æœå†æ¬¡èšåˆï¼Œä¸¤ä¸ªæ“ä½œçš„åˆå§‹å€¼éƒ½æ˜¯ zeroValue.   seqOp çš„æ“ä½œæ˜¯éå†åˆ†åŒºä¸­çš„æ‰€æœ‰å…ƒç´  (T)ï¼Œç¬¬ä¸€ä¸ª T è·Ÿ zeroValue åšæ“ä½œï¼Œç»“æœå†ä½œä¸ºä¸ç¬¬äºŒä¸ª T åšæ“ä½œçš„ zeroValueï¼Œç›´åˆ°éå†å®Œæ•´ä¸ªåˆ†åŒºã€‚combOp æ“ä½œæ˜¯æŠŠå„åˆ†åŒºèšåˆçš„ç»“æœï¼Œå†èšåˆã€‚aggregate å‡½æ•°è¿”å›ä¸€ä¸ªè·Ÿ RDD ä¸åŒç±»å‹çš„å€¼ã€‚å› æ­¤ï¼Œéœ€è¦ä¸€ä¸ªæ“ä½œ seqOp æ¥æŠŠåˆ†åŒºä¸­çš„å…ƒç´  T åˆå¹¶æˆä¸€ä¸ª Uï¼Œå¦å¤–ä¸€ä¸ªæ“ä½œ combOp æŠŠæ‰€æœ‰ U èšåˆã€‚</p>
<p>å‚è€ƒ<a href="https://blog.csdn.net/qingyang0320/article/details/51603243" target="_blank" rel="noopener">ç†è§£ Spark RDD ä¸­çš„ aggregate å‡½æ•°</a></p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šåˆå§‹å€¼ï¼ˆåœ¨è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œä¼šé»˜è®¤å¸¦å…¥è¯¥å€¼è¿›è¡Œï¼‰<br>ç¬¬äºŒä¸ªå‚æ•°:   æ˜¯ä¸¤ä¸ªå‡½æ•°[æ¯ä¸ªå‡½æ•°éƒ½æ˜¯2ä¸ªå‚æ•°(ç¬¬ä¸€ä¸ªå‡½æ•°:å…ˆå¯¹å„ä¸ªåˆ†åŒºè¿›è¡Œåˆå¹¶, ç¬¬äºŒä¸ªå‡½æ•°:å¯¹å„ä¸ªåˆ†åŒºåˆå¹¶åçš„ç»“æœå†è¿›è¡Œåˆå¹¶)] </p>
<p>æœ€åå¾—åˆ°è¿”å›å€¼</p>
<blockquote>
<p>rdd1ä¸ºä¸Šé¢çš„rdd1åˆ†åŒºå‡½æ•°çš„ç»“æœ</p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd1.aggregate(<span class="number">0</span>)(_+_, _+_)</span><br></pre></td></tr></table></figure>
<p><strong>0 + (0+1+2+3+4 + 0+5+6+7+8+9)</strong></p>
<p><img src="http://img.gangtieguo.cn/006tNbRwgy1fuck6fl2chj30kg02ut96.jpg" alt></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd1.aggregate(<span class="number">7</span>)(_+_, _+_)</span><br></pre></td></tr></table></figure>
<p><strong>7 + (7+1+2+3+4 + 7+5+6+7+8+9)</strong></p>
<p><img src="http://img.gangtieguo.cn/006tNbRwgy1fuck87fxhij30ju02gt92.jpg" alt></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd1.aggregate(<span class="number">0</span>)(math.max(_, _), _ + _)</span><br></pre></td></tr></table></figure>
<p><img src="http://img.gangtieguo.cn/006tNbRwgy1fuck95wu88j30qo02o74x.jpg" alt></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd1.aggregate(<span class="number">5</span>)(math.max(_, _), _ + _)</span><br></pre></td></tr></table></figure>
<p><strong>5å’Œ1æ¯”, å¾—5å†å’Œ234æ¯”å¾—5 â€“&gt; 5å’Œ6789æ¯”,å¾—9 â€“&gt; 5 + (5+9)</strong></p>
<p><img src="http://img.gangtieguo.cn/006tNbRwgy1fucouprhcjj30s402yjs5.jpg" alt></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd2 = sc.parallelize(<span class="type">List</span>(<span class="string">"q"</span>,<span class="string">"w"</span>,<span class="string">"e"</span>,<span class="string">"r"</span>,<span class="string">"t"</span>,<span class="string">"y"</span>,<span class="string">"u"</span>,<span class="string">"i"</span>,<span class="string">"o"</span>,<span class="string">"p"</span>),<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç”¨æ›´åŠ ç›´æ¥çš„æ–¹å¼éªŒè¯æ“ä½œ</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span></span>(index: <span class="type">Int</span>, iter: <span class="type">Iterator</span>[(<span class="type">String</span>)]) : <span class="type">Iterator</span>[<span class="type">String</span>] = &#123;</span><br><span class="line">  iter.toList.map(x =&gt; <span class="string">"[partID:"</span> +  index + <span class="string">", val: "</span> + x + <span class="string">"]"</span>).iterator</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rdd2.aggregate(<span class="string">""</span>)(_ + _, _ + _)</span><br><span class="line">rdd2.aggregate(<span class="string">"="</span>)(_ + _, _ + _)</span><br><span class="line">rdd2.aggregate(<span class="string">"|"</span>)(_ + _, _ + _)</span><br></pre></td></tr></table></figure>
<p><img src="http://img.gangtieguo.cn/006tNbRwgy1fucpd6axxej30os034wf7.jpg" alt></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd3 = sc.parallelize(<span class="type">List</span>(<span class="string">"qazqqw7"</span>,<span class="string">"jishhrwe9"</span>,<span class="string">"sdfwezsddf12"</span>,<span class="string">"12esdww8"</span>),<span class="number">2</span>)</span><br><span class="line">rdd3.aggregate(<span class="string">""</span>)((x,y) =&gt; math.max(x.length, y.length).toString, (x,y) =&gt; x + y)</span><br></pre></td></tr></table></figure>
<p><img src="http://img.gangtieguo.cn/006tNbRwgy1fucpvxoentj31gw03276d.jpg" alt></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd4 = sc.parallelize(<span class="type">List</span>(<span class="string">"qazqqw7"</span>,<span class="string">"jishhrwe9"</span>,<span class="string">"sdfwezsddf12"</span>,<span class="string">""</span>),<span class="number">2</span>)</span><br><span class="line">rdd4.aggregate(<span class="string">""</span>)((x,y) =&gt; math.min(x.length, y.length).toString, (x,y) =&gt; x + y)</span><br></pre></td></tr></table></figure>
<p><img src="http://img.gangtieguo.cn/006tNbRwgy1fucpwdi27nj31g8032abq.jpg" alt></p>
<h2 id="aggregateByKey"><a href="#aggregateByKey" class="headerlink" title="aggregateByKey"></a>aggregateByKey</h2><p>å¯¹æ¯ä¸ªåˆ†åŒºè¿›è¡Œè®¡ç®—</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> pairRDD = sc.parallelize(<span class="type">List</span>( (<span class="string">"a"</span>,<span class="number">1</span>), (<span class="string">"a"</span>, <span class="number">12</span>), (<span class="string">"b"</span>, <span class="number">4</span>),(<span class="string">"c"</span>, <span class="number">17</span>), (<span class="string">"c"</span>, <span class="number">12</span>), (<span class="string">"b"</span>, <span class="number">2</span>)), <span class="number">2</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span></span>(index: <span class="type">Int</span>, iter: <span class="type">Iterator</span>[(<span class="type">String</span>, <span class="type">Int</span>)]) : <span class="type">Iterator</span>[<span class="type">String</span>] = &#123;</span><br><span class="line">  iter.toList.map(x =&gt; <span class="string">"[partID:"</span> +  index + <span class="string">", val: "</span> + x + <span class="string">"]"</span>).iterator</span><br><span class="line">&#125;</span><br><span class="line">pairRDD.mapPartitionsWithIndex(func2).collect</span><br></pre></td></tr></table></figure>
<h2 id="combineByKey"><a href="#combineByKey" class="headerlink" title="combineByKey"></a>combineByKey</h2><p>reduceByKey aggregateByKeyåº•å±‚éƒ½æ˜¯ä¾èµ–çš„combineByKeyï¼ŒcombineByKeyæ¯”è¾ƒåº•å±‚çš„ç®—å­<br>å’ŒreduceByKeyæ˜¯ç›¸åŒçš„æ•ˆæœ</p>
<p><strong>combineByKeyæœ‰ä¸‰ä¸ªå‚æ•°</strong></p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°x: <strong>åŸå°ä¸åŠ¨å–å‡ºæ¥</strong>  ç¬¬äºŒä¸ªå‚æ•°:<strong>æ˜¯å‡½æ•°, å±€éƒ¨è¿ç®—</strong>, ç¬¬ä¸‰ä¸ª:æ˜¯å‡½æ•°, <strong>å¯¹å±€éƒ¨è¿ç®—åçš„ç»“æœå†åšè¿ç®—</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd4 = sc.parallelize(<span class="type">List</span>(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"e"</span>,<span class="string">"f"</span>,<span class="string">"g"</span>,<span class="string">"h"</span>,<span class="string">"i"</span>),<span class="number">2</span>)</span><br><span class="line"><span class="keyword">val</span> rdd5 = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>),<span class="number">2</span>)</span><br><span class="line"><span class="keyword">val</span> rdd6 = rdd5.zip(rdd4)</span><br><span class="line"><span class="keyword">val</span> rdd7 = rdd6.combineByKey(<span class="type">List</span>(_),(x:<span class="type">List</span>[<span class="type">String</span>],y:<span class="type">String</span>)=&gt;x:+y,(m:<span class="type">List</span>[<span class="type">String</span>],n:<span class="type">List</span>[<span class="type">String</span>])=&gt;m ++ n)</span><br><span class="line">rdd7.collect</span><br></pre></td></tr></table></figure>
<h2 id="reduceByKey"><a href="#reduceByKey" class="headerlink" title="reduceByKey"></a>reduceByKey</h2><p>reduceByKey ç”¨äºå¯¹æ¯ä¸ª key å¯¹åº”çš„å¤šä¸ª value è¿›è¡Œ merge æ“ä½œï¼Œæœ€é‡è¦çš„æ˜¯å®ƒèƒ½å¤Ÿåœ¨æœ¬åœ°å…ˆè¿›è¡Œ merge æ“ä½œï¼Œå¹¶ä¸” merge æ“ä½œå¯ä»¥é€šè¿‡å‡½æ•°è‡ªå®šä¹‰ã€‚</p>
<h2 id="groupByKey"><a href="#groupByKey" class="headerlink" title="groupByKey"></a>groupByKey</h2><p>groupByKey ä¹Ÿæ˜¯å¯¹æ¯ä¸ª key è¿›è¡Œæ“ä½œï¼Œä½†åªç”Ÿæˆä¸€ä¸ª sequenceã€‚ä¸ä¼šå†è¿›è¡Œ</p>
<p>éœ€è¦ç‰¹åˆ«æ³¨æ„ â€œNoteâ€ ä¸­çš„è¯ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ï¼šå¦‚æœéœ€è¦å¯¹ sequence è¿›è¡Œ aggregation æ“ä½œï¼ˆæ³¨æ„ï¼ŒgroupByKey æœ¬èº«ä¸èƒ½è‡ªå®šä¹‰æ“ä½œå‡½æ•°ï¼‰ï¼Œé‚£ä¹ˆï¼Œé€‰æ‹© reduceByKey/aggregateByKey æ›´å¥½ã€‚è¿™æ˜¯å› ä¸º groupByKey ä¸èƒ½è‡ªå®šä¹‰å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç”¨ groupByKey ç”Ÿæˆ RDDï¼Œç„¶åæ‰èƒ½å¯¹æ­¤ RDD é€šè¿‡ map è¿›è¡Œè‡ªå®šä¹‰å‡½æ•°æ“ä½œã€‚</p>
<h2 id="checkpoint"><a href="#checkpoint" class="headerlink" title="checkpoint"></a>checkpoint</h2><p>å°†rddå†…å®¹æŒä¹…åŒ–</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sc.setCheckpointDir(<span class="string">"hdfs://master:9000/ck"</span>)</span><br><span class="line"><span class="keyword">val</span> rdd = sc.textFile(<span class="string">"hdfs://master:9000/wc"</span>).flatMap(_.split(<span class="string">" "</span>)).map((_, <span class="number">1</span>)).reduceByKey(_+_)</span><br><span class="line">rdd.checkpoint</span><br><span class="line">rdd.isCheckpointed</span><br><span class="line">rdd.count</span><br><span class="line">rdd.isCheckpointed</span><br><span class="line">rdd.getCheckpointFile</span><br></pre></td></tr></table></figure>
<h2 id="coalesce-repartition"><a href="#coalesce-repartition" class="headerlink" title="coalesce, repartition"></a>coalesce, repartition</h2><p>æœ‰æ—¶å€™éœ€è¦é‡æ–°è®¾ç½® Rdd çš„åˆ†åŒºæ•°é‡ï¼Œæ¯”å¦‚ Rdd çš„åˆ†åŒºä¸­ï¼ŒRdd åˆ†åŒºæ¯”è¾ƒå¤šï¼Œä½†æ˜¯æ¯ä¸ª Rdd çš„æ•°æ®é‡æ¯”è¾ƒå°ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„åˆ†åŒºã€‚æˆ–è€…éœ€è¦æŠŠ Rdd çš„åˆ†åŒºæ•°é‡è°ƒå¤§ã€‚è¿˜æœ‰å°±æ˜¯é€šè¿‡è®¾ç½®ä¸€ä¸ª Rdd çš„åˆ†åŒºæ¥è¾¾åˆ°è®¾ç½®ç”Ÿæˆçš„æ–‡ä»¶çš„æ•°é‡ã€‚</p>
<p>å¦‚æœåˆ†åŒºçš„æ•°é‡å‘ç”Ÿæ¿€çƒˆçš„å˜åŒ–ï¼Œå¦‚è®¾ç½® numPartitions = 1ï¼Œè¿™å¯èƒ½ä¼šé€ æˆè¿è¡Œè®¡ç®—çš„èŠ‚ç‚¹æ¯”ä½ æƒ³è±¡çš„è¦å°‘ï¼Œä¸ºäº†é¿å…è¿™ä¸ªæƒ…å†µï¼Œå¯ä»¥è®¾ç½® shuffle=trueï¼Œ</p>
<p>é‚£ä¹ˆè¿™ä¼šå¢åŠ  shuffle æ“ä½œã€‚</p>
<p>å…³äºè¿™ä¸ªåˆ†åŒºçš„æ¿€çƒˆçš„å˜åŒ–æƒ…å†µï¼Œæ¯”å¦‚åˆ†åŒºæ•°é‡ä»çˆ¶ Rdd çš„å‡ åƒä¸ªåˆ†åŒºè®¾ç½®æˆå‡ ä¸ªï¼Œæœ‰å¯èƒ½ä¼šé‡åˆ°è¿™ä¹ˆä¸€ä¸ªé”™è¯¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.io.IOException: Unable to acquire 16777216 bytes of memory</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªé”™è¯¯åªè¦æŠŠ shuffle è®¾ç½®æˆ true å³å¯è§£å†³ã€‚</p>
<p>å½“æŠŠçˆ¶ Rdd çš„åˆ†åŒºæ•°é‡å¢å¤§æ—¶ï¼Œæ¯”å¦‚ Rdd çš„åˆ†åŒºæ˜¯ 100ï¼Œè®¾ç½®æˆ 1000ï¼Œå¦‚æœ shuffle ä¸º falseï¼Œå¹¶ä¸ä¼šèµ·ä½œç”¨ã€‚</p>
<p>è¿™æ—¶å€™å°±éœ€è¦è®¾ç½® shuffle ä¸º true äº†ï¼Œé‚£ä¹ˆ Rdd å°†åœ¨ shuffle ä¹‹åè¿”å›ä¸€ä¸ª 1000 ä¸ªåˆ†åŒºçš„ Rddï¼Œæ•°æ®åˆ†åŒºæ–¹å¼é»˜è®¤æ˜¯é‡‡ç”¨ hash partitionerã€‚</p>
<p>æœ€åæ¥çœ‹çœ‹ repartition() æ–¹æ³•çš„æºç ï¼š</p>
<p>coalesce() æ–¹æ³•çš„ä½œç”¨æ˜¯è¿”å›æŒ‡å®šä¸€ä¸ªæ–°çš„æŒ‡å®šåˆ†åŒºçš„ Rddã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="number">1</span> to <span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">val</span> rdd2 = rdd1.coalesce(<span class="number">2</span>, <span class="literal">false</span>)</span><br><span class="line">rdd2.partitions.length</span><br></pre></td></tr></table></figure>
<p><a href="https://www.cnblogs.com/fillPv/p/5392186.html" target="_blank" rel="noopener"></a></p>
<h2 id="collectAsMap"><a href="#collectAsMap" class="headerlink" title="collectAsMap"></a>collectAsMap</h2><p>å°†å…¶ä»–é›†åˆä¿å­˜ä¸ºmapç»“æ„</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>((<span class="string">"a"</span>, <span class="number">1</span>), (<span class="string">"b"</span>, <span class="number">2</span>)))</span><br><span class="line">rdd.collectAsMap</span><br><span class="line">å¾—åˆ°ç»“æœ</span><br><span class="line"><span class="type">Map</span>(b -&gt; <span class="number">2</span>, a -&gt; <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="countByKey"><a href="#countByKey" class="headerlink" title="countByKey"></a>countByKey</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>((<span class="string">"a"</span>, <span class="number">1</span>), (<span class="string">"b"</span>, <span class="number">2</span>), (<span class="string">"b"</span>, <span class="number">2</span>), (<span class="string">"c"</span>, <span class="number">2</span>), (<span class="string">"c"</span>, <span class="number">1</span>)))</span><br><span class="line">rdd1.countByKey </span><br><span class="line">ç»Ÿè®¡<span class="type">Key</span>å‡ºç°çš„æ¬¡æ•°</span><br><span class="line">ç»“æœ <span class="type">Map</span>(b -&gt; <span class="number">2</span>, a -&gt; <span class="number">1</span>, c -&gt; <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h2 id="countByValue"><a href="#countByValue" class="headerlink" title="countByValue"></a>countByValue</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>((<span class="string">"a"</span>, <span class="number">1</span>), (<span class="string">"b"</span>, <span class="number">2</span>), (<span class="string">"b"</span>, <span class="number">2</span>), (<span class="string">"c"</span>, <span class="number">2</span>), (<span class="string">"c"</span>, <span class="number">1</span>)))</span><br><span class="line">rdd1.countByValue</span><br><span class="line">ç»“æœ (å°†æ•´ä¸ªå…ƒç»„ä½œä¸ºkey)</span><br><span class="line"><span class="type">Map</span>((b,<span class="number">2</span>) -&gt; <span class="number">2</span>, (c,<span class="number">2</span>) -&gt; <span class="number">1</span>, (a,<span class="number">1</span>) -&gt; <span class="number">1</span>, (c,<span class="number">1</span>) -&gt; <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="filterByRange"><a href="#filterByRange" class="headerlink" title="filterByRange"></a>filterByRange</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>((<span class="string">"a"</span>, <span class="number">5</span>), (<span class="string">"b"</span>, <span class="number">3</span>), (<span class="string">"c"</span>, <span class="number">4</span>), (<span class="string">"d"</span>, <span class="number">2</span>), (<span class="string">"e"</span>, <span class="number">1</span>)))</span><br><span class="line"><span class="keyword">val</span> rdd2 = rdd1.filterByRange(<span class="string">"b"</span>, <span class="string">"d"</span>)</span><br><span class="line">rdd2.collect</span><br><span class="line"></span><br><span class="line"><span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((b,<span class="number">3</span>), (c,<span class="number">4</span>), (d,<span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<h2 id="flatMapValues"><a href="#flatMapValues" class="headerlink" title="flatMapValues"></a>flatMapValues</h2><p>å‹å¹³</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd3 = sc.parallelize(<span class="type">List</span>((<span class="string">"a"</span>, <span class="string">"1 2"</span>), (<span class="string">"b"</span>, <span class="string">"3 4"</span>)))</span><br><span class="line"><span class="keyword">val</span> rdd4 = rdd3.flatMapValues(_.split(<span class="string">" "</span>))</span><br><span class="line">rdd4.collect</span><br><span class="line"></span><br><span class="line"><span class="type">Array</span>[(<span class="type">String</span>, <span class="type">String</span>)] = <span class="type">Array</span>((a,<span class="number">1</span>), (a,<span class="number">2</span>), (b,<span class="number">3</span>), (b,<span class="number">4</span>))</span><br></pre></td></tr></table></figure>
<h2 id="foldByKey"><a href="#foldByKey" class="headerlink" title="foldByKey"></a>foldByKey</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>(<span class="string">"a22"</span>, <span class="string">"b232"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>), <span class="number">2</span>)</span><br><span class="line"><span class="keyword">val</span> rdd2 = rdd1.map(x =&gt; (x.length, x))</span><br><span class="line">rdd2.collect</span><br><span class="line">ç»“æœï¼š <span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">String</span>)] = <span class="type">Array</span>((<span class="number">3</span>,a22), (<span class="number">4</span>,b232), (<span class="number">1</span>,c), (<span class="number">1</span>,d))</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> rdd3 = rdd2.foldByKey(<span class="string">""</span>)(_+_)</span><br><span class="line">rdd3.collect</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç»“æœï¼šå°†ç›¸åŒkeyçš„å…ƒç»„åˆå¹¶åœ¨ä¸€èµ·ï¼Œ</span><br><span class="line"><span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">String</span>)] = <span class="type">Array</span>((<span class="number">4</span>,b232), (<span class="number">1</span>,cd), (<span class="number">3</span>,a22))</span><br></pre></td></tr></table></figure>
<h2 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h2><p>foreachæ˜¯é’ˆå¯¹äºæ¯ä¸€ä¸ªå…ƒç´ ï¼Œ<br>foreachPartitionæ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªåˆ†åŒºï¼Œ<br>foreachPartitionæ˜¯å†™å…¥æ•°æ®åº“æ—¶ï¼Œå¯ä»¥å°†åœ¨foreachPartitionæ—¶è·å¾—ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œé€šè¿‡mapæ–¹æ³•æ¥å°†æ¯ä¸ªåˆ†åŒºçš„å…¨éƒ¨å…ƒç´ å†™å…¥åˆ°æ•°æ®åº“</p>
<h2 id="foreachPartition"><a href="#foreachPartition" class="headerlink" title="foreachPartition"></a>foreachPartition</h2><p>3ä¸ªåˆ†åŒº</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>), <span class="number">3</span>)</span><br><span class="line">rdd1.foreachPartition(x =&gt; println(x.reduce(_ + _)))</span><br></pre></td></tr></table></figure>
<h2 id="keyBy"><a href="#keyBy" class="headerlink" title="keyBy"></a>keyBy</h2><p>ä»¥ä¼ å…¥çš„å‚æ•°åškey</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>(<span class="string">"dog"</span>, <span class="string">"salmon"</span>, <span class="string">"salmon"</span>, <span class="string">"rat"</span>, <span class="string">"elephant"</span>), <span class="number">3</span>)</span><br><span class="line"><span class="keyword">val</span> rdd2 = rdd1.keyBy(_.length)</span><br><span class="line">rdd2.collect</span><br><span class="line">ç»“æœ <span class="type">Array</span>((<span class="number">3</span>,dog), (<span class="number">6</span>,salmon), (<span class="number">6</span>,salmon), (<span class="number">3</span>,rat), (<span class="number">8</span>,elephant))</span><br></pre></td></tr></table></figure>
<h2 id="keys-values"><a href="#keys-values" class="headerlink" title="keys values"></a>keys values</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">List</span>(<span class="string">"dog"</span>, <span class="string">"tiger"</span>, <span class="string">"lion"</span>, <span class="string">"cat"</span>, <span class="string">"panther"</span>, <span class="string">"eagle"</span>), <span class="number">2</span>)</span><br><span class="line"><span class="keyword">val</span> rdd2 = rdd1.map(x =&gt; (x.length, x))</span><br><span class="line">rdd2.keys.collect</span><br><span class="line">rdd2.values.collect</span><br></pre></td></tr></table></figure>

            

        </div>

        <footer class="article-footer">

        
        <! -- æ·»åŠ æèµ å›¾æ ‡ -->
<div class="post-donate">
    <div id="donate_board" class="donate_bar center">
        <a id="btn_donate" class="btn_donate" href="javascript:;" title="æ‰“èµ"></a>
        <span class="donate_txt">
           å¦‚æœæ‚¨è§‰å¾—æ–‡ç« ä¸é”™ï¼Œå°±è¯·æˆ‘çœ‹åœºufcç›´æ’­ğŸ¤“ğŸ¤“ğŸ¤“ğŸ¤“ğŸ¤“ï¼
        </span>
        <br>
      </div>  
    <div id="donate_guide" class="donate_bar center hidden">
        <!-- æ”¯ä»˜å®æ‰“èµå›¾æ¡ˆ -->
        <img src="/css/images/alipay.jpg" alt="æ”¯ä»˜å®æ‰“èµ"> 
        <!-- å¾®ä¿¡æ‰“èµå›¾æ¡ˆ -->
        <img src="/css/images/wechatpay.jpg" alt="å¾®ä¿¡æ‰“èµ">  
    </div>
    <script type="text/javascript">
        document.getElementById('btn_donate').onclick = function(){
            if($('#donate_guide').hasClass('hidden')){
                $('#donate_guide').removeClass('hidden');
            }else{
                $('#donate_guide').addClass('hidden');
            }
        }
    </script>
</div>
<! -- æ·»åŠ æèµ å›¾æ ‡ -->
        
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">åˆ†äº«åˆ°ï¼š</a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="åˆ†äº«åˆ°QQç©ºé—´">QQç©ºé—´</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="åˆ†äº«åˆ°æ–°æµªå¾®åš">æ–°æµªå¾®åš</a>
    <a href="#" class="bds_tqq" data-cmd="tqq" title="åˆ†äº«åˆ°è…¾è®¯å¾®åš">è…¾è®¯å¾®åš</a>
    <a href="#" class="bds_renren" data-cmd="renren" title="åˆ†äº«åˆ°äººäººç½‘">äººäººç½‘</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="åˆ†äº«åˆ°å¾®ä¿¡">å¾®ä¿¡</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    
        <a href="http://gangtieguo.cn/2018/08/15/Sparkç®—å­/#comments" class="article-comment-link">è¯„è®º</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2018/08/15/SparkStreamingæ¶ˆè´¹Kafkaæ•°æ®/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
            <div class="article-nav-title">
                
                    SparkStreamingæ¶ˆè´¹Kafkaæ•°æ®
                
            </div>
        </a>
    
    
        <a href="/2018/08/15/ScalaåŸºæœ¬ä½¿ç”¨/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
            <div class="article-nav-title">ScalaåŸºæœ¬ä½¿ç”¨-æ‚è®°</div>
        </a>
    
</nav>


    
</article>


    
    
        <section id="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC8zNjM2MS8xMjg5Ng=="></div>
</section>
    

</section>
            
            
        </div>
        <footer id="footer">

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol ==='https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2019 GTG<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a><br>Analyse with <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1273739152'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1273739152%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>

<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1273739152'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1273739152%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>
        </div>
    </div>
</footer>
        
    
    
    <!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
    <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];

         if (typeof LivereTower === 'function') { return; }

         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;

         e.parentNode.insertBefore(j, e);
     })(document, 'script');
    </script>
  <noscript> ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
  <!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->





    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>